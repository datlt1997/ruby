<% content_for :title, "Danh sách bài viết" %>
<% content_for :title_page, "Danh sách bài viết" %>
<div class="card mb-3">
  <%= form_with url: admin_posts_path, class: "form-search", method: :get, local: true do |form| %>
    <div class="imput-search-group">
      <%= form.label :q, "Tìm kiếm tiêu đề", class: "col-form-label label-form-search" %>
      <%= form.text_field :q, value: params[:q], class: "form-control input-form-search", placeholder: "Nhập tiêu đề..." %>
    </div>
    <%= form.submit "Tìm kiếm", class: "btn btn-primary bth-search" %>
  <% end %>
  <div class="card-body mx-2">
    <%= link_to "New post", new_admin_post_path, class: "btn btn-primary" %>
    <table class="table mb-3">
        <thead>
          <tr>
            <th scope="col">#</th>
            <th scope="col">Title</th>
            <th scope="col">Short description</th>
            <th scope="col">Tag</th>
            <th scope="col">Image</th>
            <th scope="col">Views</th>
            <th scope="col">Action</th>
          </tr>
        </thead>
        <tbody>
          <% @posts.each do |post| %>
              <tr>
                  <td><%= post.id %></td>
                  <td><%= post.title %></td>
                  <td><%= truncate(post.short_description, length: 30)  %></td>
                  <td>
                    <% post.tags.limit(3).each do |tag| %>
                      <span class="badge bg-secondary">
                        <%= truncate(tag.name, length: 20) %>
                      </span>
                    <% end %>
                  </td>
                  <td><%= image_tag(post.image, size: "100x70") if post.image.present? %></td>
                  <td><%= post.views_count ? post.views_count : 0  %></td>
                  <td>
                    <%= link_to edit_admin_post_path(post), class: "btn btn-primary" do %>
                      <%= icon('fa-solid', 'pen') %>
                    <% end %>
                    <%= button_to admin_post_path(post), method: :delete, data: { turbo_confirm: "Are you sure?" }, form: { class: 'd-inline-block' }, class: "btn btn-danger" do %>
                      <%= icon('fa-solid', 'trash')%>
                    <% end %>
                  </td>
              </tr>
          <% end %>
        </tbody>
      </table>
      <div class="pagination">
        <%= paginate @posts %>
      </div>
  </div>
</div>